# その他確認したことメモ
他に調べたことをここで残しておく。
※サイズ込みの分析をしようとなると、Wiresharkを使う必要ありそう、というのは分かった。

## ネットワーク上の通信のデータサイズを、ポート単位、プロセス単位で、抽出する方法 ※Windows環境

<Claude確認結果>
Windows環境でネットワーク通信のデータサイズをポート単位・プロセス単位で抽出する方法をいくつか紹介します。

1. PowerShellを使った方法（最も簡単）

powershell
Get-NetTCPConnection | Select-Object LocalAddress, LocalPort, RemoteAddress, RemotePort, OwningProcess, State | Format-Table

OwningProcessの値をプロセス名に変換したい場合は：

powershell
Get-NetTCPConnection | ForEach-Object {
    $process = Get-Process -Id $_.OwningProcess -ErrorAction SilentlyContinue
    $_ | Add-Member -MemberType NoteProperty -Name ProcessName -Value $process.Name -Force
    $_
} | Select-Object ProcessName, LocalPort, RemotePort, State | Format-Table


2. netstatコマンド（従来の方法）

コマンドプロンプトで：

cmd
netstat -ano
オプション説明：

-a : すべての接続とリッスンポートを表示
-n : アドレスとポート番号を数値形式で表示
-o : 各接続に関連するプロセスIDを含める


3. Wiresharkを使った詳細な分析

より詳細なデータサイズ情報が必要な場合は、Wiresharkでパケットをキャプチャして分析できます。これはバイト単位でのデータサイズを確認できます。


4. Windows Performance Analyzer（WPA）

Windows Performance Toolkitに含まれるWPAは、ネットワークトレースから詳細な統計を取得できます。


5. Pythonでの自動化例

業務ツールとして作るなら、Pythonで以下のように実装できます：

python
import subprocess
import json

def get_network_stats():
    result = subprocess.run(
        ['powershell', '-Command', 
         'Get-NetTCPConnection | ConvertTo-Json -Depth 3'],
        capture_output=True,
        text=True
    )
    connections = json.loads(result.stdout)
    
    # プロセス単位で集計
    by_process = {}
    for conn in connections:
        pid = conn['OwningProcess']
        port = conn['LocalPort']
        key = f"PID:{pid} Port:{port}"
        by_process[key] = by_process.get(key, 0) + 1
    
    return by_process

if __name__ == '__main__':
    stats = get_network_stats()
    for key, count in sorted(stats.items(), key=lambda x: x[1], reverse=True):
        print(f"{key}: {count}")
おすすめの選択

クイック確認 → PowerShellコマンド
継続的な監視・自動化 → Pythonスクリプト
詳細なデータサイズ分析 → Wireshark


