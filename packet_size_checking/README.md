# ネットワークパケットサイズ計測プログラム

ネットワーク上を流れるデータサイズを計測するための、シンプルなTCPエコーサーバー/クライアントプログラムです。

## 概要

- **サーバー**: 複数のクライアントからの接続を受け付け、受信したデータをそのまま送り返す（エコーバック）
- **クライアント**: 3～5秒周期で100～1000バイトのランダムなASCII文字列をサーバーに送信し、エコーバックを受信
- データサイズの統計情報をリアルタイムで表示

## ファイル構成

- `server.py` - サーバープログラム
- `client.py` - クライアントプログラム
- `README.md` - このファイル

## 実行方法

### 1. サーバーを起動

まず、ターミナル（コマンドプロンプトまたはPowerShell）を開いてサーバーを起動します。

```bash
python server.py
```

起動すると以下のように表示されます：
```
サーバー起動: 127.0.0.1:12345
クライアントからの接続を待機中...
```

### 2. クライアント1を起動

別のターミナルを開いて、1つ目のクライアントを起動します。

```bash
python client.py 1
```

### 3. クライアント2を起動

さらに別のターミナルを開いて、2つ目のクライアントを起動します。

```bash
python client.py 2
```

### 停止方法

各プログラムを停止するには、`Ctrl+C` を押してください。統計情報が表示されて終了します。

## 動作仕様

### サーバー（server.py）

- **待受アドレス**: 127.0.0.1:12345
- **機能**:
  - 複数クライアントの同時接続をサポート（スレッド処理）
  - 受信したデータをそのまま送り返す（エコーバック）
  - 10秒ごとに統計情報を表示
    - メッセージ数
    - 総受信量（バイト、KB）
    - 総送信量（バイト、KB）
    - 平均レート（バイト/秒）

### クライアント（client.py）

- **送信間隔**: 3～5秒（ランダム）
- **送信データサイズ**: 100～1000バイト（ランダム）
- **データ内容**: ランダムなASCII文字列（英数字、記号、スペース）
- **機能**:
  - サーバーにデータを送信
  - エコーバックされたデータを受信
  - 送受信データの一致を検証
  - 各送受信のサイズをリアルタイム表示
  - 終了時に統計情報を表示

### 通信プロトコル

各メッセージは以下の形式で送信されます：

```
[4バイト: メッセージ長（ビッグエンディアン）][可変長: メッセージ本体]
```

この形式により、可変長のメッセージを正確に送受信できます。

## 出力例

### サーバー側の表示

```
サーバー起動: 127.0.0.1:12345
クライアントからの接続を待機中...

[14:23:15] クライアント接続: ('127.0.0.1', 52341)
[14:23:15] ('127.0.0.1', 52341) - 受信: 558バイト, 送信: 558バイト
[14:23:16] クライアント接続: ('127.0.0.1', 52342)
[14:23:18] ('127.0.0.1', 52342) - 受信: 723バイト, 送信: 723バイト

=== 統計情報 (稼働時間: 10.0秒) ===
メッセージ数: 2
総受信量: 1,281 バイト (1.25 KB)
総送信量: 1,281 バイト (1.25 KB)
平均レート: 受信 128.1 バイト/秒, 送信 128.1 バイト/秒
==================================================
```

### クライアント側の表示

```
[クライアント1] サーバーに接続中: 127.0.0.1:12345
[クライアント1] 接続成功

[14:23:15.123] クライアント1 - 送信: 558バイト (データ: 554バイト)
[14:23:15.125] クライアント1 - 受信: 558バイト
[14:23:15.125] クライアント1 - ✓ データ検証成功
[14:23:15.125] クライアント1 - 次の送信まで 4.3秒待機
```

## 計測可能な情報

このプログラムでは以下の情報を計測できます：

1. **送信データサイズ**: アプリケーション層で送信したバイト数（4バイトの長さヘッダー + データ本体）
2. **受信データサイズ**: アプリケーション層で受信したバイト数
3. **メッセージ数**: 送受信したメッセージの総数
4. **総データ量**: 累積の送受信バイト数
5. **データレート**: 平均的な送受信速度（バイト/秒）

## 注意事項

- このプログラムはアプリケーション層でのデータサイズを計測します
- 実際のネットワーク上では、TCPヘッダー（20バイト）、IPヘッダー（20バイト）などのオーバーヘッドが追加されます
- より詳細なネットワーク層の計測には、Wireshark などのパケットキャプチャツールの使用を推奨します

## カスタマイズ

設定を変更したい場合は、各ファイルの先頭にある定数を編集してください：

- `HOST`, `PORT`: サーバーのアドレスとポート番号
- `generate_random_ascii(min_size, max_size)`: データサイズの範囲
- `random.uniform(3.0, 5.0)`: 送信間隔の範囲

## 必要な環境

- Python 3.6 以上
- 標準ライブラリのみ使用（追加のインストールは不要）
